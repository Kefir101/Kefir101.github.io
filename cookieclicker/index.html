<html lang="en">

<head>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/cookieclicker.css">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cookie Clicker</title>
</head>

<body>
  <script src="/js/sketch.js"></script>
  <h1 class="accounttitle">Cookie Clicker</h1>

  <div id="cookiepanel" style="z-index: -1;">
    <p id="cookieCount" style="font-size: 40px; transform: translateX(375px);">0 cookies</p>
    <p id="cookiesPerSecond" style="font-size: 20px; transform: translate(400px, -47px);">per second: 0</p>
    <img style="transform: translateX(200px); z-index: -1; display: inline;" src="/img/cookie.png" alt="cookie?"
      id="maincookie">
    <div id="buildingsInCookie" style="transform: translate(192px, -232px);">
      <div id="cursors" class="obj"></div>
    </div>
    <div id="clickedcookies"></div>
  </div>

  <div id="shop">
    <h2 id="shoptitle">Store</h2>
  </div>
</body>
<script>
  let img = document.getElementById("maincookie");
  img.addEventListener("click", setMousePos);

  const buildings = ["cursor", "grandma", "farm", "mine", "factory", "bank", "temple"];
  const buildingShopInfo = ["Autoclicks once every 10 seconds.", "A nice grandma to bake more cookies.",
    "Grows cookie plants from cookie seeds.", "Mines out cookie dough and chocolate chips.",
    "Produces large quantites of cookies.", "Generates cookies from interest.",
    "Full of precious, ancient chocolate."]
  let buildingPrices = [15, 100, 1100, 12000, 130000, 1400000, 20000000];
  let buildingCookiePerSecond = [0.1, 1, 8, 47, 260, 1400, 7800, 44000];
  let buildingCookiesProduced = Array(buildings.length).fill(0);
  let newUnlock = false;
  let buildingsUnlocked = 2, buildingsFullyUnlocked = 0;
  let buildingsUnlockedArr = [true, true].concat(Array(buildings.length - 2).fill(false));
  let cookiesInPreviousSecond = 0;

  for (let i = 0; i < buildingsUnlocked; i++) {
    newUnlock = true;
    unlockBuilding(i);
  }

  var startedClicking = false;
  var cookies = 0;
  var sec = 0;
  var mouseX, mouseY;
  everyMillisecond();
  everySecond();
  function unlockBuilding(i){
    if(!newUnlock) return;
    let name = buildings[i];
    let price = buildingPrices[i];
    let Name = name.substring(0, 1).toUpperCase() + name.substring(1);
    let buildingcount = name + "count";

    let inCookieDiv = document.createElement("div");
    inCookieDiv.id = name + "s";
    document.getElementById("buildingsInCookie").append(inCookieDiv);

    let numberOfBuildings = document.getElementById(name + "s").childElementCount;
    let mainDivID = "buy" + Name + "s";
    let mainDiv = document.createElement("div");
    mainDiv.id = mainDivID;
    document.getElementById("shop").append(mainDiv);

    let button = document.createElement("button");
    button.id = name + "btn";
    button.classList.add("shopbtn");
    button.classList.add(name);
    button.onmouseover = function (event) {
      console.log("mouse over");
      if(document.getElementById(name + "shopbtninfo").visibility = "hidden") showInfo(name + "s", buildingcount);
    }
    button.onmouseleave = function (event) {
      console.log("mouse left");
      if(document.getElementById(name + "shopbtninfo").visibility = "visible") removeInfo(name + "s", buildingcount);
    }
    button.onclick = function (event) {
      buyItem(name + "s", name + "shopbtnitemcount");
    }
    document.getElementById(mainDivID).append(button);
    
    let shopIcon = buildElement("shopIcon", "img", name + "shopbtnicon", "pointer-events: none; filter: brightness(0); width: 64px; transform: translate(-150px, -2px); position: absolute;", 
    "shopbtnicon " + name, button, "", "/cookieclickerimg/" + Name + "Shop.png");

    let itemName = buildElement("itemName", "h4", name + "shopbtnitemname", "pointer-events: none; text-align: left; transform: translate(75px, 8px);", 
    "shopbtnitemname " + name, button, "???");

    let priceDiv = buildElement("priceDiv", "div", name + "shopbtnitempriceandcookie", "pointer-events: none; transform: translate(113px, -6px); position: absolute;", 
    "shopbtnitempriceandcookie " + name, button);

    let minicookie = buildElement("minicookie", "img", name + "shopbtnitempricecookie", "pointer-events: none; transform: translate(-38px, 10px); width: 18px; height: 18px;", 
    "shopbtnitempricecookie " + name, priceDiv, "", "/img/cookie.png");

    let priceTag = buildElement("priceTag", "p", name + "shopbtnitemprice", "pointer-events: none; display: inline-block; font-size: 14; transform: translate(-35px, 5px);", 
    "shopbtnitemprice " + name, priceDiv, "<b>" + buildingPrices[i] + "</b>");

    let itemCount = buildElement("itemCount", "h5", name + "shopbtnitemcount", "pointer-events: none; transform: translate(123px, -28px);", "shopbtnitemcount " + name, button, 0);

    let infoDiv = buildElement("infoDiv", "div", name + "shopbtninfo", "pointer-events: none; position: absolute; width: 400px; height: 80px; background-color: black; border: 3px solid transparent; border-image: url(/cookieclickerimg/FrameBorder.png) 3 round; border-radius: 2px; transform: translate(-405px, -70px); visibility: hidden; color: grey;",
     "shopbtninfo " + name, mainDiv);

    let mainInfoDiv = buildElement("mainInfoDiv", "div", name + "shopbtnmaininfo", "transform: translate(-345px, -70px);",
     "shopbtnmaininfo " + name, infoDiv);

    let imgInfo = buildElement("imgInfo", "img", name + "shopbtnimginfo", "width: 35px; height: auto; transform: translate(357px, 75px);",
     "shopbtnimginfo " + name, mainInfoDiv, "",  "/cookieclickerimg/lockedBuilding.png");

    let nameInfo = buildElement("nameInfo", "p", name + "shopbtnnameinfo", "transform: translate(405px, 12px); text-align: left; color: white; font-size: 20px;",
     "shopbtnnameinfo " + name, mainInfoDiv, "???");

    let numberOwnedInfo = buildElement("numberOwnedInfo", "p", name + "shopbtnownedinfo", "transform: translate(406px, -7px); font-size: 11px; color: grey;",
     "shopbtnownedinfo " + name, mainInfoDiv, "[owned : " + numberOfBuildings + "]");

    let priceInfo = buildElement("priceInfo", "div", name + "shopbtnpriceinfo", "transform: translate(556px, -60px);",
     "shopbtnpriceinfo " + name, mainInfoDiv, "none", "", priceDiv.cloneNode(true));

    
     newUnlock = false;
  }
  function buildElement(elementName, elementType, elementID, elementStyle, elementClass, elementToAppendTo, elementInnerHTML = "", elementSrc = "", clone = false){
    let element;
    if(clone != false){
      element = clone;
      element.classList.remove(...element.classList);
    } else{
      element = document.createElement(elementType);
    }
    if(elementSrc != "") element.src = elementSrc;
    element.id = elementID;
    element.style = elementStyle;
    element.classList.add(...elementClass.split(" "));
    if(elementInnerHTML != "none") element.innerHTML = elementInnerHTML;
    elementToAppendTo.append(element);
    return element;
  }
  function setMousePos(event) {
    mouseX = event.clientX;
    mouseY = event.clientY;
    clicked();
  }
  function clicked() {
    if (!startedClicking) {
      startedClicking = true;
    }
    var clickedCookie = document.createElement("div");
    clickedCookie.style = `display: inline; z-index: 1;  position: absolute; transform: translate(${mouseX - 45}px, ${mouseY - 800}px);`;
    clickedCookie.addEventListener("click", setMousePos);

    var clickedCookieText = document.createElement("p");
    clickedCookieText.innerHTML = "+1";
    clickedCookieText.style = "display: inline-block; color: white;"
    clickedCookieText.classList.add("clickedcookietext");
    clickedCookie.append(clickedCookieText);

    var clickedCookieCookie = document.createElement("img");
    clickedCookieCookie.src = "/img/cookie.png";
    clickedCookieCookie.style = "display: inline-block; transform: translate(5px, 10px); position: relative; width: 35px; height: 35px;";
    clickedCookieCookie.classList.add("clickedcookiecookie");
    clickedCookie.append(clickedCookieCookie)

    clickedCookie.classList.add("clickedcookie");
    document.getElementById("clickedcookies").append(clickedCookie);
    changeCookie(1);
  }
  function changeCookie(change) {
    var cookieCount = document.getElementById("cookieCount");
    let currentCookies = parseFloat(cookieCount.innerHTML.split(" ")[0]);
    currentCookies += change;
    cookies = Math.round(currentCookies * 10) / 10;
    cookieCount.innerHTML = cookies + " cookies";
  }
  function everyMillisecond() {
    buildings.forEach((name, i) => {
      if(i >= buildingsUnlocked) return;
      let Name = name.substring(0, 1).toUpperCase() + name.substring(1);
      let id = "buy" + name.substring(0, 1).toUpperCase() + name.substring(1) + "s";
      let priceTag = document.getElementById(id).getElementsByClassName("shopbtnitemprice")[0];
      let priceInfoDiv = document.getElementById(id).querySelector("#" + name + "shopbtnpriceinfo");
      let cost = buildingPrices[i];
      var color = (cost > cookies) ? priceTag.style.color = "red" : priceTag.style.color = "green";
      var color = (cost > cookies) ? priceInfoDiv.style.color = "red" : priceInfoDiv.style.color = "green";
      let numberOfBuildings = document.getElementById(name + "s").childElementCount;
      document.getElementById(name + "shopbtnownedinfo").innerHTML = "[owned : " + numberOfBuildings + "]";
      if(buildingsFullyUnlocked > i){
        console.log(i);
        document.getElementById(name + "shopbtnsinglecpsinfo").innerHTML = "each " + name + " produces " + "<big><b class = 'cookienumber'>" + buildingCookiePerSecond[i] + "</b></big> cookies per second";
        document.getElementById(name + "shopbtntotalcpsinfo").innerHTML = numberOfBuildings + " " + name + "(s) producing " + "<big><b class = 'cookienumber'>" + buildingCookiePerSecond[i] * numberOfBuildings + "</b></big> cookies per second";
        document.getElementById(name + "shopbtncookiesproducedinfo").innerHTML = "<big><b class = 'cookienumber'>" + buildingCookiesProduced[i] + "</b></big> cookies produced so far";
      }
      if(cookies >= cost && !buildingsUnlockedArr[i+2]) {
        newUnlock = true;
        buildingsUnlocked++;
        buildingsFullyUnlocked++;
        unlockBuilding(buildingsUnlocked - 1)
        buildingsUnlockedArr[i+2] = true;
        document.getElementById(name + "shopbtnitemname").innerHTML = Name;
        console.log(document.getElementById(name + "shopbtnicon").style);
        document.getElementById(name + "shopbtnicon").style.filter = "brightness(1)";
        document.getElementById(name + "shopbtninfo").style.height = "170px";
        document.getElementById(name + "shopbtnimginfo").src = "/cookieclickerimg/" + Name + "InfoIcon.png";
        document.getElementById(name + "shopbtnnameinfo").innerHTML = Name;
        document.getElementById(name + "shopbtnimginfo").style = "width: 50px; height: auto; transform: translate(350px, 75px);";

        let infoDiv = document.getElementById(name + "shopbtninfo");

        let descriptionInfo = buildElement("descriptionInfo", "p", name + "shopbtndescriptioninfo", "font-size: 15px; transform: translate(10px, -100px); text-align: left;",
     "shopbtndescriptioninfo " + name, infoDiv, buildingShopInfo[i]);

        let statsInfoList = buildElement("statsInfoList", "ul", name + "shopbtnstatsinfo", "list-style-type: circle; transform: translate(-15px, -96px); font-size: 10px; text-align: left;",
     "shopbtnstatsinfo " + name, infoDiv, "", "");

       let singleCpsInfo = buildElement("singleCpsInfo", "li", name + "shopbtnsinglecpsinfo", "transform: translate(0px, 0px);",
     "shopbtnsinglecpsinfo " + name, statsInfoList, "each " + name + " produces " + "<big><b class = 'cookienumber'>" + buildingCookiePerSecond[i] + "</b></big> cookies per second", "");

       let totalCpsInfo = buildElement("totalCpsInfo", "li", name + "shopbtntotalcpsinfo", "transform: translate(0px, 0px);",
     "shopbtntotalcpsinfo " + name, statsInfoList, numberOfBuildings + " " + name + "(s) producing " + "<big><b class = 'cookienumber'>" + buildingCookiePerSecond[i] * numberOfBuildings + "</b></big> cookies per second", "");
       
     let cookiesProducedInfo = buildElement("cookiesProducedInfo", "li", name + "shopbtncookiesproducedinfo", "transform: translate(0px, 0px);",
     "shopbtncookiesproducedinfo " + name, statsInfoList, "<big><b class = 'cookienumber'>" + buildingCookiesProduced[i] + "</b></big> cookies produced so far", "");

      }
    });
    setTimeout("everyMillisecond()", 0.1);
  }
  function everySecond() {
    if (startedClicking) {
      sec++;
      getCookiesFromBuildings();
      let cps = Math.round((cookies - cookiesInPreviousSecond) * 10) / 10;
      if(cps < 0) cps = 0;
      cookiesPerSecond.innerHTML = "per second: " + cps;
      cookiesInPreviousSecond = cookies;

      var cursors = document.getElementById("cursors").children;
      for (var i = 0; i < cursors.length; i++) {
        cursors[i].secondsPassed += 1;
      }
    }
    setTimeout("everySecond()", 1000);
  }
  function getCookiesFromBuildings() {
    for (let i = 0; i < buildings.length; i++) {
      let id = buildings[i] + "s";
      if (document.getElementById(id) != null) {
        let cookiesProduced = 0;
        if(id == "cursors"){
          var cursors = document.getElementById("cursors").children;
          for (var j = 0; j < cursors.length; j++) {
            console.log(cursors[j].secondsPassed);
            if(cursors[j].secondsPassed % 10 == 0 && cursors[j].secondsPassed > 0) cookiesProduced++;
          }
        } else{
          let count = document.getElementById(id).childElementCount;
          cookiesProduced = count * buildingCookiePerSecond[i];
        }
        changeCookie(cookiesProduced);
        buildingCookiesProduced[i] += cookiesProduced;
        buildingCookiesProduced[i] = Math.round(buildingCookiesProduced[i] * 10) / 10
      }
    }
  }
  function buyItem(itemID, itemCountID) {
    const itemName = itemID.substring(0, itemID.length - 1);
    const itemIndex = buildings.indexOf(itemName);
    let itemPrice = buildingPrices[itemIndex];
    var cookieCount = document.getElementById("cookieCount");
    let currentCookies = cookieCount.innerHTML.split(" ")[0];
    if (currentCookies >= itemPrice) {
      changeCookie(-itemPrice);
      const element = document.getElementById(itemID);
      var div = document.createElement('div');
      var numberOfChildElements = element.childElementCount;
      if (itemID == "cursors") {
        let xShift = numberOfChildElements * 5;
        let yShift = numberOfChildElements * 10;
        div.secondsPassed = 0;
        div.classList.add("singlecursor");
        div.classList.add("inner");
        div.style = `transform: rotate(${numberOfChildElements * -30}deg) translate(${xShift}px, ${yShift}px);`
      } else {
        let divclass = "single" + itemID.substring(0, itemID.length - 1);
        div.classList.add(divclass);
      }
      buildingPrices[itemIndex] = Math.round(buildingPrices[itemIndex] * 1.15);
      document.getElementById(itemName + "shopbtnitemprice").innerHTML = "<b>" + buildingPrices[itemIndex] + "</b>";
      let id = "buy" + itemName.substring(0, 1).toUpperCase() + itemName.substring(1) + "s";
      document.getElementById(id).querySelector(".shopbtnpriceinfo p").innerHTML = "<b>" + buildingPrices[itemIndex] + "</b>";
      element.appendChild(div);
      document.getElementById(itemCountID).innerText = element.childElementCount;
    }
  }
  function showInfo(itemID, itemCountID) {
    const itemName = itemID.substring(0, itemID.length - 1);
    const itemIndex = buildings.indexOf(itemName);
    const infoID = itemName + "shopbtninfo";
    document.getElementById(infoID).style.visibility = "visible";
  }
  function removeInfo(itemID, itemCountID) {
    const itemName = itemID.substring(0, itemID.length - 1);
    const itemIndex = buildings.indexOf(itemName);
    const infoID = itemName + "shopbtninfo";
    document.getElementById(infoID).style.visibility = "hidden";
  }
</script>

</html>

